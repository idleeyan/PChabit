<?xml version="1.0" encoding="UTF-8" ?>
<Page
    x:Class="Tai.App.Views.KeyboardDetailsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModel="using:Tai.App.ViewModels"
    mc:Ignorable="d">
    
    <ScrollViewer Padding="24">
        <StackPanel Spacing="24">
            <Grid>
                <TextBlock
                    FontSize="24"
                    FontWeight="SemiBold"
                    Text="按键详情" />
                
                <StackPanel
                    HorizontalAlignment="Right"
                    Orientation="Horizontal"
                    Spacing="8">
                    <Button
                        Padding="8,4"
                        Click="PreviousDay_Click"
                        Content="&#xE76B;"
                        FontFamily="Segoe MDL2 Assets"
                        ToolTipService.ToolTip="前一天" />
                    <TextBlock
                        VerticalAlignment="Center"
                        Text="{x:Bind ViewModel.SelectedDate, Converter={StaticResource DateToStringConverter}, Mode=OneWay}" />
                    <Button
                        Padding="8,4"
                        Click="NextDay_Click"
                        Content="&#xE76C;"
                        FontFamily="Segoe MDL2 Assets"
                        ToolTipService.ToolTip="后一天" />
                </StackPanel>
            </Grid>
            
            <Grid ColumnSpacing="16" RowSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <Border
                    Grid.Column="0"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="4">
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="总按键次数"
                            ToolTipService.ToolTip="当日累计按下的所有按键总数，包括字母、数字、符号等" />
                        <TextBlock
                            FontSize="20"
                            FontWeight="SemiBold"
                            Text="{x:Bind ViewModel.TotalKeyPresses, Mode=OneWay}" />
                    </StackPanel>
                </Border>
                
                <Border
                    Grid.Column="1"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="4">
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="平均速度"
                            ToolTipService.ToolTip="平均打字速度：每分钟按键次数（KPM）" />
                        <TextBlock
                            FontSize="20"
                            FontWeight="SemiBold"
                            Text="{x:Bind ViewModel.AverageSpeed, Mode=OneWay}" />
                    </StackPanel>
                </Border>
                
                <Border
                    Grid.Column="2"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="4">
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="峰值速度"
                            ToolTipService.ToolTip="当日最高打字速度：每分钟按键次数（KPM）" />
                        <TextBlock
                            FontSize="20"
                            FontWeight="SemiBold"
                            Text="{x:Bind ViewModel.PeakSpeed, Mode=OneWay}" />
                    </StackPanel>
                </Border>
                
                <Border
                    Grid.Column="3"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="4">
                        <TextBlock
                            FontSize="12"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Text="快捷键使用"
                            ToolTipService.ToolTip="当日使用的键盘快捷键组合总次数（如 Ctrl+C、Ctrl+V 等）" />
                        <TextBlock
                            FontSize="20"
                            FontWeight="SemiBold"
                            Text="{x:Bind ViewModel.ShortcutsUsed, Mode=OneWay}" />
                    </StackPanel>
                </Border>
            </Grid>
            
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <Border
                    Grid.Column="0"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="16">
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="按键使用排行"
                            ToolTipService.ToolTip="显示使用频率最高的20个按键，按使用次数降序排列" />
                        
                        <ListView
                            ItemsSource="{x:Bind ViewModel.KeyUsageList, Mode=OneWay}"
                            SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewModel:KeyUsageItem">
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="60" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="60" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <Border
                                            Padding="8,4"
                                            Background="{x:Bind Color}"
                                            CornerRadius="4">
                                            <TextBlock
                                                HorizontalAlignment="Center"
                                                FontWeight="Medium"
                                                Text="{x:Bind KeyName}" />
                                        </Border>
                                        
                                        <ProgressBar
                                            Grid.Column="1"
                                            Margin="8,0"
                                            VerticalAlignment="Center"
                                            Maximum="100"
                                            Value="{x:Bind Percentage}" />
                                        
                                        <TextBlock
                                            Grid.Column="2"
                                            VerticalAlignment="Center"
                                            Text="{x:Bind Count}" />
                                        
                                        <TextBlock
                                            Grid.Column="3"
                                            VerticalAlignment="Center"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="{x:Bind Percentage, Converter={StaticResource PercentageConverter}}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>
                
                <Border
                    Grid.Column="1"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="16">
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="编辑统计"
                            ToolTipService.ToolTip="编辑类按键的使用统计，反映文本编辑活动的频繁程度" />
                        
                        <StackPanel Spacing="12">
                            <Grid>
                                <TextBlock Text="退格键" />
                                <TextBlock
                                    HorizontalAlignment="Right"
                                    FontWeight="SemiBold"
                                    Text="{x:Bind ViewModel.BackspaceCount, Mode=OneWay}" />
                            </Grid>
                            <Grid>
                                <TextBlock Text="删除键" />
                                <TextBlock
                                    HorizontalAlignment="Right"
                                    FontWeight="SemiBold"
                                    Text="{x:Bind ViewModel.DeleteCount, Mode=OneWay}" />
                            </Grid>
                        </StackPanel>
                        
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="常用快捷键"
                            ToolTipService.ToolTip="当日使用最频繁的快捷键组合及其使用次数" />
                        
                        <ListView
                            ItemsSource="{x:Bind ViewModel.TopShortcuts, Mode=OneWay}"
                            SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewModel:ShortcutItem">
                                    <Grid Margin="0,4">
                                        <TextBlock Text="{x:Bind Shortcut}" />
                                        <TextBlock
                                            HorizontalAlignment="Right"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="{x:Bind Count}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>
            </Grid>
            
            <Grid ColumnSpacing="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                
                <Border
                    Grid.Column="0"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="16">
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="每小时按键分布"
                            ToolTipService.ToolTip="每小时内的按键次数分布，数值表示该小时内的总按键数" />
                        
                        <ItemsControl ItemsSource="{x:Bind ViewModel.HourlyData, Mode=OneWay}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="viewModel:HourlyKeyItem">
                                    <Grid Margin="0,4">
                                        <TextBlock Width="50" Text="{x:Bind Hour}" />
                                        <ProgressBar
                                            Margin="60,0,80,0"
                                            Maximum="1000"
                                            Value="{x:Bind Presses}" />
                                        <TextBlock HorizontalAlignment="Right" Text="{x:Bind Presses}" />
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
                
                <Border
                    Grid.Column="1"
                    Padding="16"
                    Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="12">
                    <StackPanel Spacing="16">
                        <TextBlock
                            FontSize="16"
                            FontWeight="SemiBold"
                            Text="应用按键统计"
                            ToolTipService.ToolTip="各应用程序的按键使用统计，包括按键次数和平均打字速度" />
                        
                        <Grid Margin="0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="80" />
                                <ColumnDefinition Width="80" />
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock
                                FontSize="11"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="应用名称" />
                            <TextBlock
                                Grid.Column="1"
                                FontSize="11"
                                HorizontalAlignment="Right"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="按键次数" />
                            <TextBlock
                                Grid.Column="2"
                                FontSize="11"
                                HorizontalAlignment="Right"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                Text="KPM" />
                        </Grid>
                        
                        <ListView
                            ItemsSource="{x:Bind ViewModel.AppKeyUsage, Mode=OneWay}"
                            SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="viewModel:AppKeyItem">
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="80" />
                                            <ColumnDefinition Width="80" />
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBlock Text="{x:Bind ProcessName}" />
                                        <TextBlock
                                            Grid.Column="1"
                                            HorizontalAlignment="Right"
                                            Text="{x:Bind KeyPresses}" />
                                        <TextBlock
                                            Grid.Column="2"
                                            HorizontalAlignment="Right"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="{x:Bind AvgSpeed}" />
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </StackPanel>
                </Border>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</Page>
