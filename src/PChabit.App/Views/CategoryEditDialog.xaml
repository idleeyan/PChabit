<?xml version="1.0" encoding="UTF-8" ?>
<ContentDialog
    x:Class="PChabit.App.Views.CategoryEditDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    PrimaryButtonClick="OnPrimaryButtonClick"
    PrimaryButtonText="确定"
    SecondaryButtonText="取消"
    DefaultButton="Primary">
    
    <ContentDialog.Resources>
        <x:Double x:Key="ContentDialogMaxWidth">500</x:Double>
    </ContentDialog.Resources>
    
    <StackPanel Spacing="16" MinWidth="400">
        <TextBlock
            FontSize="20"
            FontWeight="SemiBold"
            Text="{x:Bind ViewModel.DialogTitle, Mode=OneWay}" />
        
        <StackPanel Spacing="12">
            <StackPanel Spacing="4">
                <TextBlock Text="分类名称" />
                <TextBox
                    PlaceholderText="输入分类名称"
                    Text="{x:Bind ViewModel.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    IsEnabled="{x:Bind ViewModel.CanEditName, Mode=OneWay}" />
                <TextBlock
                    FontSize="12"
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Text="{x:Bind ViewModel.NameError, Mode=OneWay}"
                    Visibility="{x:Bind ViewModel.HasNameError, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StackPanel>
            
            <StackPanel Spacing="4">
                <TextBlock Text="描述（可选）" />
                <TextBox
                    PlaceholderText="输入分类描述"
                    Text="{x:Bind ViewModel.Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    AcceptsReturn="True"
                    TextWrapping="Wrap"
                    Height="60" />
            </StackPanel>
            
            <StackPanel Spacing="8">
                <TextBlock Text="颜色" />
                <ItemsControl ItemsSource="{x:Bind ViewModel.AvailableColors, Mode=OneWay}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="10" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border
                                Width="32"
                                Height="32"
                                Margin="2"
                                Background="{Binding Converter={StaticResource StringToBrushConverter}}"
                                CornerRadius="4"
                                Tapped="OnColorTapped"
                                Tag="{Binding}"
                                ToolTipService.ToolTip="{Binding}">
                                <Border
                                    Width="28"
                                    Height="28"
                                    CornerRadius="3">
                                    <Border.Background>
                                        <SolidColorBrush Color="Transparent" />
                                    </Border.Background>
                                </Border>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
            
            <StackPanel Spacing="8">
                <TextBlock Text="图标" />
                <ItemsControl ItemsSource="{x:Bind ViewModel.AvailableIcons, Mode=OneWay}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="9" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border
                                Width="36"
                                Height="36"
                                Margin="2"
                                Background="{ThemeResource SubtleFillColorTertiaryBrush}"
                                CornerRadius="4"
                                Tapped="OnIconTapped"
                                Tag="{Binding}">
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="18"
                                    Text="{Binding}" />
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
            
            <StackPanel Spacing="8" Orientation="Horizontal">
                <TextBlock Text="预览：" VerticalAlignment="Center" />
                <Border
                    Padding="8,4"
                    Background="{x:Bind ViewModel.SelectedColor, Mode=OneWay, Converter={StaticResource StringToBrushConverter}}"
                    CornerRadius="4">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{x:Bind ViewModel.SelectedIcon, Mode=OneWay}" />
                        <TextBlock
                            Foreground="White"
                            Text="{x:Bind ViewModel.Name, Mode=OneWay}" />
                    </StackPanel>
                </Border>
            </StackPanel>
            
            <StackPanel
                Orientation="Horizontal"
                Spacing="8"
                Visibility="{x:Bind ViewModel.IsSystemCategory, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                <FontIcon
                    FontSize="14"
                    Foreground="{ThemeResource SystemFillColorCautionBrush}"
                    Glyph="&#xE7BA;" />
                <TextBlock
                    FontSize="12"
                    Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                    Text="系统分类，名称不可修改" />
            </StackPanel>
        </StackPanel>
    </StackPanel>
</ContentDialog>
